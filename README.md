# Week8 실전프로젝트

## 프로젝트 명 : 프로미스톡

### 프로젝트간략 설명
> 더이상 약속을 깨트리지 마세요. 약속을 관리하고 또 친구와 공유하세요!

### BE 팀원
 - 이승환, 최진원, 김성재
###
api명세서 : https://www.notion.so/2de1c1447f4347e896223a9964c69463?v=4057a04afd194b5488036d538974dadf

***

## 2주차. 

### 주요 개발사항
1. FCM OR KAKAO 알림톡을 이용한 알림구현
2. STOMP를 이용한 채팅기능 구현 ✔️
3. 카카오 지도 API를 활용한 마커기능 추가. ✔️

9월 26일까지 지난주 토요일 회의에서 기능구현 하기로 한 부분구현 (약속 완료 api외 4개 api) ✔️

이번 주도 힘내주세요!
 
## 트러블 슈팅

#### 1. [🟠해결중] 신용도나 포인트가 중간중간 값이 0이 되버리는 경우가 보임

 - 에러 사항 : 가끔 DB의 값들을 모니터링 할 때 포인트나 신용도가 중간중간 0이 되버리는 버그가 있는 것을 확인했음 (9월 29일 기준 DB클리어 이후 보이진 않음)
 - SOLVE : DB가 수정되지 않아 생긴 오류일 것으로 보이므로, DB클리어 시점에서 해결 된 것같지만 지속적인 모니터링으로 해당현상의 정확한 원인 파악이 필요함.
 
 #### 2. [🟢해결완료] 서버시간 관련 이슈

 - 에러 사항 : EC2서버를 사용중이므로 서버에 올라간 서비스의 시간이 UTC로 고정되어 약속알고리즘을 돌렸을때 한국시간기준이 아닌 UTC기준으로 결과들이 출력되게 됨. (남은시간, 체크인불가능 등의 부분)
 - SOLVE :  코드부분에서 타임존을 세팅하는 구문이 작동하지 않아서, 서버 자동배포시 실행구문에 시간설정구문을 추가하여 해결함.
 
 #### 3. [🟢해결완료] websocket connection to failed connection closed to (ws요청시 서버는 열려있지만 서버까지 요청이 오지 않던 경우)

 - 에러 사항 : WS을 사용해서 클라이언트에서 메세지를 받기위해 WS서버 요청을 할 때 서버가 꺼져있다는 오류문구 출력
 - SOLVE : 호출 구문의 맨뒤에 /websocket을 붙여서 호출하면 정상 작동함.
 
 #### 4. [🟢해결중] -

 - 에러 사항 : 
 - SOLVE : 

***

## 1주차. 

### 주요 개발사항
1. DB ✔️
2. api설계 ✔️
3. 기본 기능들 구현 ✔️

9월 24일까지 로그인,회원가입,약속CRUD,친구페이지 기능 구현 완료 목표 ✔️

#### 레포지토리 클론해갔을때 resourse 경로 아래에 application-aws.properties 파일 생성필수. 
내용은 개인 DM으로 드리겠습니다.

## 트러블 슈팅

#### 1. [🟢해결완료] unable to evaluate the expression method threw 'org.hibernate.lazyinitializationexception' exception

 - 에러 사항 : 엔티티 컬럼 LAZY 이슈
 - SOLVE : 엔티티 객체를 불러올때 지연로딩을 해서 실제 사용할때 값을 알 수 없어 에러가 발생. 해당 ENTITIY만 EAGER로 변경.

#### 2. [🟢해결완료] org.hibernate.loader.MultipleBagFetchException: cannot simultaneously fetch multiple bags 

- 에러 사항 : 두개의 EAGER사용제약
- SOLVE : 양방향 사용을 위해 EAGER 컬럼을 두개 생성하여 제약사항에 걸림. 정말 필요한 컬럼을 남기고 단방향 설계로 수정.

#### 3. [🟢해결완료] 카카오 로그인 구현시 넘어오는 값으로 회원가입 구현불가

- 제약 사항 : 카카오 api에서 넘어온 info에 유저인증 식별자로 사용하고 있던 전화번호가 들어있지 않음. 회원가입과 로그인 할 때 토큰생성 불가능.
- SOLVE : 유저인증을 기본키 id로 할 수 있게 변경함. 변경함으로써 닉네임이나 전화번호등 겉으로 드러나는 정보가 수정될 때 토큰 재생성을 할 필요가 없음

#### 4. [🟢해결완료] oauth로그인했을때 토큰인증이 필요한 api호출시 401에러 (인증실패)를 반환

- 에러 사항 : 로컬테스트로 코드 테스트 결과 소셜로그인회원의 로그인이후 securitycontextholder에 jwt토큰을 같이 넣어서 유저정보를 넣지 않던 것을 확인, 
추가로 header prefix형식도 기존 filter에서 체크하는 형식과도 같지 않던 부분 확인함.
- SOLVE : 토큰 생성부분을 contextholder에 유저정보를 넣는 부분보다 앞으로 당겨줌. 토큰 생성부에서 붙이는 prefix값을 BEARER에서 Bearer로 수정해줌. (이 부분은 filter에서 prefix부분만 uppercase 또는 lowercase형식으로 모두 받을 수 있게 수정해도 괜찮을 것 같음) 

#### 5. [🟢해결완료] 네이버 로그인할때 로컬에서 로그인이 진행되지만 프론트에서 허용된 사이트가 아니라 로그인 할 수 없던 부분.

- 에러 사항 : 프론트의 개발환경 (localhost:3000)에서 로그인 요청이 허용되지 않던 점
- SOLVE : api web서비스 부분을 잘못 이해하고 있었음. be의 서버주소를 적는 것이 아닌 실제 서비스가 동작할 부분의 주소를 적어야함. localhost:3000을 서비스 url로 지정해주어 해결함.

